dist: bionic

jobs:
  include:
    - language: python
      python: 3.7
      cache:
        directories:
          - env
      before_install:
        - cd backend
        - openssl aes-256-cbc -K $encrypted_9e09dc4a4da7_key -iv $encrypted_9e09dc4a4da7_iv -in serviceAccountKey.json.enc -out serviceAccountKey.json -d
        - ./create_env.sh
        - source activate env
      install:
        - pip install -r requirements.txt
        - pip install -r requirements-dev.txt
      script:
        - python -m pytest
      deploy:
        provider: heroku
        app: meeting-scheduler-backend
        api_key:
          secure: "30u862t1ChkIcXSxS36VVqcYnPVp+SlAfv9LPluseF6hBJk8ohZwtdH3PB5Z2t5b58lLRm09ZgfRf6KWe/rlmeH9ggSGNXZJ4eu5l5Mlx8Xy4u0FhPk+XNJQ2npHxSqDIING2JG05P/CzlYlHKxg8QR6Ejhxk59DUIvuxm/7LGyw744dpyKr+mHEcRPpnD0AKVW9qKUr99BI9Ca5LeCJvBiKsBmTDmf8iM0CDnaDDtvwenp8dW+a3duadyXw3IWgw8rHymTidikhsBj9ZPXn7GP2/M3Q7mZoAxB9tnY5+IEcVZLqzzbKAjGYpYLZffoP0Bqe0MjzvZgeVrFCyOUk6z6qXTDfDBnDopP9jMDppUnKv2L0KzNZdCnn9Uuh5XTbMUS0wBSsq1pNNiNSMT5tiY7iHfh20k9fMx23dfswaSU3MCiHWa/xv5IOOy0PftLK4A/iOS9FI0oYlg/DqbpihOQQ8b3AtGIkCVjh5oCm0MfRV/szxHfU+3PGA/J6gqJg3VVzfwTsX2lCa+rzOdr1r7TKxGqODVWUFFupVW8mCn8KuRSa0iS3DMuBhC3X9CERdKJFTk18e6k9aHGeSrAsSLWOk94tCS97FeFRN+BFWUeXrf27qRFDKJCQs8vk79btVPUvObCVL3I9GekcpH1YVpzWoSaanCHXTjVfcB3xtWs="
        strategy: git
      on:
        branch: master
      after_deploy:
        - ./run_app.sh

    - language: node_js
      node_js:
        - 'node'
        - 'lts/*'
      cache:
        directories:
          - node_modules
      before_install:
        - cd frontend
      install:
        - npm install
      script:
        - npm run build
      deploy:
        provider: heroku
        app: meeting-scheduler-frontend
        api_key:
          secure: "30u862t1ChkIcXSxS36VVqcYnPVp+SlAfv9LPluseF6hBJk8ohZwtdH3PB5Z2t5b58lLRm09ZgfRf6KWe/rlmeH9ggSGNXZJ4eu5l5Mlx8Xy4u0FhPk+XNJQ2npHxSqDIING2JG05P/CzlYlHKxg8QR6Ejhxk59DUIvuxm/7LGyw744dpyKr+mHEcRPpnD0AKVW9qKUr99BI9Ca5LeCJvBiKsBmTDmf8iM0CDnaDDtvwenp8dW+a3duadyXw3IWgw8rHymTidikhsBj9ZPXn7GP2/M3Q7mZoAxB9tnY5+IEcVZLqzzbKAjGYpYLZffoP0Bqe0MjzvZgeVrFCyOUk6z6qXTDfDBnDopP9jMDppUnKv2L0KzNZdCnn9Uuh5XTbMUS0wBSsq1pNNiNSMT5tiY7iHfh20k9fMx23dfswaSU3MCiHWa/xv5IOOy0PftLK4A/iOS9FI0oYlg/DqbpihOQQ8b3AtGIkCVjh5oCm0MfRV/szxHfU+3PGA/J6gqJg3VVzfwTsX2lCa+rzOdr1r7TKxGqODVWUFFupVW8mCn8KuRSa0iS3DMuBhC3X9CERdKJFTk18e6k9aHGeSrAsSLWOk94tCS97FeFRN+BFWUeXrf27qRFDKJCQs8vk79btVPUvObCVL3I9GekcpH1YVpzWoSaanCHXTjVfcB3xtWs="
        strategy: git
        project: ./dist/
      on:
        branch: master
